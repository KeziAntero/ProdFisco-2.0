{
    "sourceFile": "src/pages/EditarPRT.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1757095833915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1757096041429,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -205,10 +205,10 @@\n             <CardTitle>Adicionar Novo Serviço</CardTitle>\n             <CardDescription>Complete os campos abaixo para adicionar um item de serviço</CardDescription>\n           </CardHeader>\n           <CardContent className=\"space-y-4\">\n-            <div className=\"grid grid-cols-1 md:grid-cols-12 gap-4\">\n-              <div className=\"md:col-span-5\">\n+            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-12 gap-4\">\n+              <div className=\"sm:col-span-2 lg:col-span-5\">\n                 <Label>Tipo de Serviço *</Label>\n                 <Select value={novoItem.servico_id} onValueChange={handleServicoChange}>\n                   <SelectTrigger>\n                     <SelectValue placeholder=\"Selecione o serviço\" />\n@@ -222,9 +222,9 @@\n                   </SelectContent>\n                 </Select>\n               </div>\n \n-              <div className=\"md:col-span-3\">\n+              <div className=\"sm:col-span-2 lg:col-span-3\">\n                 <Label htmlFor=\"id_documento\">ID Documento *</Label>\n                 <Input\n                   id=\"id_documento\"\n                   value={novoItem.id_documento}\n@@ -232,9 +232,9 @@\n                   placeholder=\"ID do documento\"\n                 />\n               </div>\n \n-              <div className=\"md:col-span-2\">\n+              <div className=\"sm:col-span-1 lg:col-span-2\">\n                 <Label htmlFor=\"qtd_fiscais\">Qtd. Fiscais *</Label>\n                 <Input\n                   id=\"qtd_fiscais\"\n                   type=\"number\"\n@@ -243,9 +243,9 @@\n                   onChange={(e) => handleQtdFiscaisChange(Number(e.target.value))}\n                 />\n               </div>\n \n-              <div className=\"md:col-span-2\">\n+              <div className=\"sm:col-span-1 lg:col-span-2\">\n                 <Label htmlFor=\"quantidade\">Quantidade</Label>\n                 <Input\n                   id=\"quantidade\"\n                   type=\"number\"\n"
                },
                {
                    "date": 1757096236531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n import { Textarea } from '@/components/ui/textarea';\n import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\n import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\n-import { Trash2, Plus } from 'lucide-react';\n+import { Trash2, Plus, Edit, Check, X } from 'lucide-react';\n import { useServicos } from '@/hooks/useServicos';\n import { useRegistros, useUpdateRegistro, ItemServico } from '@/hooks/useRegistros';\n \n interface FormItem {\n@@ -26,8 +26,9 @@\n   const navigate = useNavigate();\n   const [competencia, setCompetencia] = useState('');\n   const [anotacoes, setAnotacoes] = useState('');\n   const [itens, setItens] = useState<FormItem[]>([]);\n+  const [editingItem, setEditingItem] = useState<string | null>(null);\n   const [novoItem, setNovoItem] = useState<FormItem>({\n     tempId: '',\n     servico_id: '',\n     id_documento: '',\n@@ -113,8 +114,38 @@\n   const removerItem = (tempId: string) => {\n     setItens(prev => prev.filter(item => item.tempId !== tempId));\n   };\n \n+  const iniciarEdicao = (item: FormItem) => {\n+    setEditingItem(item.tempId);\n+    setNovoItem(item);\n+  };\n+\n+  const cancelarEdicao = () => {\n+    setEditingItem(null);\n+    setNovoItem({\n+      tempId: '',\n+      servico_id: '',\n+      id_documento: '',\n+      qtd_fiscais: 1,\n+      quantidade: undefined,\n+      pontuacao_calculada: 0,\n+      observacoes: '',\n+    });\n+  };\n+\n+  const salvarEdicao = () => {\n+    if (!novoItem.servico_id || !novoItem.id_documento) {\n+      return;\n+    }\n+\n+    setItens(prev => prev.map(item => \n+      item.tempId === editingItem ? novoItem : item\n+    ));\n+    \n+    cancelarEdicao();\n+  };\n+\n   const totalPontos = itens.reduce((sum, item) => sum + item.pontuacao_calculada, 0);\n \n   const handleSubmit = async (e: React.FormEvent) => {\n     e.preventDefault();\n@@ -307,24 +338,113 @@\n                 </TableHeader>\n                 <TableBody>\n                   {itens.map((item) => {\n                     const servico = servicos?.find(s => s.id === item.servico_id);\n+                    const isEditing = editingItem === item.tempId;\n+                    \n                     return (\n                       <TableRow key={item.tempId}>\n-                        <TableCell>{servico?.descricao}</TableCell>\n-                        <TableCell>{item.id_documento}</TableCell>\n-                        <TableCell>{item.qtd_fiscais}</TableCell>\n-                        <TableCell>{item.quantidade || '-'}</TableCell>\n+                        <TableCell>\n+                          {isEditing ? (\n+                            <Select value={novoItem.servico_id} onValueChange={handleServicoChange}>\n+                              <SelectTrigger className=\"w-full\">\n+                                <SelectValue placeholder=\"Selecione o serviço\" />\n+                              </SelectTrigger>\n+                              <SelectContent>\n+                                {servicos?.filter(servico => servico.id && servico.id.trim() !== '').map((servico) => (\n+                                  <SelectItem key={servico.id} value={servico.id}>\n+                                    {servico.descricao}\n+                                  </SelectItem>\n+                                ))}\n+                              </SelectContent>\n+                            </Select>\n+                          ) : (\n+                            servico?.descricao\n+                          )}\n+                        </TableCell>\n+                        <TableCell>\n+                          {isEditing ? (\n+                            <Input\n+                              value={novoItem.id_documento}\n+                              onChange={(e) => setNovoItem(prev => ({ ...prev, id_documento: e.target.value }))}\n+                              placeholder=\"ID do documento\"\n+                            />\n+                          ) : (\n+                            item.id_documento\n+                          )}\n+                        </TableCell>\n+                        <TableCell>\n+                          {isEditing ? (\n+                            <Input\n+                              type=\"number\"\n+                              min=\"1\"\n+                              value={novoItem.qtd_fiscais}\n+                              onChange={(e) => handleQtdFiscaisChange(Number(e.target.value))}\n+                            />\n+                          ) : (\n+                            item.qtd_fiscais\n+                          )}\n+                        </TableCell>\n+                        <TableCell>\n+                          {isEditing ? (\n+                            <Input\n+                              type=\"number\"\n+                              step=\"0.01\"\n+                              value={novoItem.quantidade || ''}\n+                              onChange={(e) => setNovoItem(prev => ({ ...prev, quantidade: e.target.value ? Number(e.target.value) : undefined }))}\n+                              placeholder=\"Quantidade\"\n+                            />\n+                          ) : (\n+                            item.quantidade || '-'\n+                          )}\n+                        </TableCell>\n                         <TableCell>{item.pontuacao_calculada.toFixed(2)}</TableCell>\n                         <TableCell>\n-                          <Button\n-                            type=\"button\"\n-                            variant=\"ghost\"\n-                            size=\"sm\"\n-                            onClick={() => removerItem(item.tempId)}\n-                          >\n-                            <Trash2 className=\"h-4 w-4\" />\n-                          </Button>\n+                          <div className=\"flex gap-1\">\n+                            {isEditing ? (\n+                              <>\n+                                <Button\n+                                  type=\"button\"\n+                                  variant=\"ghost\"\n+                                  size=\"sm\"\n+                                  onClick={salvarEdicao}\n+                                  title=\"Salvar\"\n+                                >\n+                                  <Check className=\"h-4 w-4 text-green-600\" />\n+                                </Button>\n+                                <Button\n+                                  type=\"button\"\n+                                  variant=\"ghost\"\n+                                  size=\"sm\"\n+                                  onClick={cancelarEdicao}\n+                                  title=\"Cancelar\"\n+                                >\n+                                  <X className=\"h-4 w-4 text-red-600\" />\n+                                </Button>\n+                              </>\n+                            ) : (\n+                              <>\n+                                <Button\n+                                  type=\"button\"\n+                                  variant=\"ghost\"\n+                                  size=\"sm\"\n+                                  onClick={() => iniciarEdicao(item)}\n+                                  title=\"Editar\"\n+                                >\n+                                  <Edit className=\"h-4 w-4\" />\n+                                </Button>\n+                                <Button\n+                                  type=\"button\"\n+                                  variant=\"ghost\"\n+                                  size=\"sm\"\n+                                  onClick={() => removerItem(item.tempId)}\n+                                  title=\"Excluir\"\n+                                >\n+                                  <Trash2 className=\"h-4 w-4\" />\n+                                </Button>\n+                              </>\n+                            )}\n+                          </div>\n                         </TableCell>\n                       </TableRow>\n                     );\n                   })}\n"
                },
                {
                    "date": 1757096854135,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -193,11 +193,14 @@\n   }\n \n   return (\n     <div className=\"space-y-6\">\n-      <div>\n-        <h1 className=\"text-3xl font-bold\">Editar PRT</h1>\n-        <p className=\"text-muted-foreground\">Registro de Produtividade de Fiscalização - #{registro.numero_registro}</p>\n+      <div className=\"flex items-center gap-4\">\n+        <img src=\"/logo.svg\" alt=\"ProdFisco Logo\" className=\"w-12 h-12\" />\n+        <div>\n+          <h1 className=\"text-3xl font-bold\">Editar PRT</h1>\n+          <p className=\"text-muted-foreground\">Registro de Produtividade Fiscal - #{registro.numero_registro}</p>\n+        </div>\n       </div>\n \n       <form onSubmit={handleSubmit} className=\"space-y-6\">\n         <Card>\n"
                }
            ],
            "date": 1757095833915,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Trash2, Plus } from 'lucide-react';\nimport { useServicos } from '@/hooks/useServicos';\nimport { useRegistros, useUpdateRegistro, ItemServico } from '@/hooks/useRegistros';\n\ninterface FormItem {\n  tempId: string;\n  servico_id: string;\n  id_documento: string;\n  qtd_fiscais: number;\n  quantidade?: number;\n  pontuacao_calculada: number;\n  observacoes?: string;\n}\n\nexport default function EditarPRT() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [competencia, setCompetencia] = useState('');\n  const [anotacoes, setAnotacoes] = useState('');\n  const [itens, setItens] = useState<FormItem[]>([]);\n  const [novoItem, setNovoItem] = useState<FormItem>({\n    tempId: '',\n    servico_id: '',\n    id_documento: '',\n    qtd_fiscais: 1,\n    quantidade: undefined,\n    pontuacao_calculada: 0,\n    observacoes: '',\n  });\n\n  const { data: servicos, isLoading: loadingServicos } = useServicos();\n  const { data: registros, isLoading: loadingRegistro } = useRegistros();\n  const updateRegistro = useUpdateRegistro();\n\n  const registro = registros?.find(r => r.id === id);\n\n  useEffect(() => {\n    if (registro) {\n      setCompetencia(registro.competencia);\n      setAnotacoes(registro.anotacoes || '');\n      \n      // Converter itens de serviço para formato do formulário\n      const itensForm: FormItem[] = registro.itens_servico?.map((item, index) => ({\n        tempId: `existing-${index}`,\n        servico_id: item.servico_id,\n        id_documento: item.id_documento,\n        qtd_fiscais: item.qtd_fiscais,\n        quantidade: item.quantidade,\n        pontuacao_calculada: item.pontuacao_calculada,\n        observacoes: item.observacoes,\n      })) || [];\n      \n      setItens(itensForm);\n    }\n  }, [registro]);\n\n  const calcularPontuacao = (servicoId: string, qtdFiscais: number) => {\n    const servico = servicos?.find(s => s.id === servicoId);\n    if (!servico) return 0;\n    return Number((servico.pontuacao_base / qtdFiscais).toFixed(2));\n  };\n\n  const handleServicoChange = (servicoId: string) => {\n    const pontuacao = calcularPontuacao(servicoId, novoItem.qtd_fiscais);\n    setNovoItem(prev => ({\n      ...prev,\n      servico_id: servicoId,\n      pontuacao_calculada: pontuacao,\n    }));\n  };\n\n  const handleQtdFiscaisChange = (qtd: number) => {\n    const pontuacao = calcularPontuacao(novoItem.servico_id, qtd);\n    setNovoItem(prev => ({\n      ...prev,\n      qtd_fiscais: qtd,\n      pontuacao_calculada: pontuacao,\n    }));\n  };\n\n  const adicionarItem = () => {\n    if (!novoItem.servico_id || !novoItem.id_documento) {\n      alert('Preencha os campos obrigatórios');\n      return;\n    }\n\n    const item: FormItem = {\n      ...novoItem,\n      tempId: Date.now().toString(),\n    };\n\n    setItens(prev => [...prev, item]);\n    setNovoItem({\n      tempId: '',\n      servico_id: '',\n      id_documento: '',\n      qtd_fiscais: 1,\n      quantidade: undefined,\n      pontuacao_calculada: 0,\n      observacoes: '',\n    });\n  };\n\n  const removerItem = (tempId: string) => {\n    setItens(prev => prev.filter(item => item.tempId !== tempId));\n  };\n\n  const totalPontos = itens.reduce((sum, item) => sum + item.pontuacao_calculada, 0);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!id) return;\n    \n    if (itens.length === 0) {\n      alert('Adicione pelo menos um item de serviço');\n      return;\n    }\n\n    const itensServico: ItemServico[] = itens.map(item => ({\n      servico_id: item.servico_id,\n      id_documento: item.id_documento,\n      qtd_fiscais: item.qtd_fiscais,\n      quantidade: item.quantidade,\n      pontuacao_calculada: item.pontuacao_calculada,\n      observacoes: item.observacoes,\n    }));\n\n    try {\n      await updateRegistro.mutateAsync({\n        id,\n        registro: {\n          competencia,\n          total_pontos: totalPontos,\n          situacao: 'ativo',\n          anotacoes,\n        },\n        itens: itensServico,\n      });\n      \n      navigate('/lista');\n    } catch (error) {\n      console.error('Erro ao atualizar:', error);\n    }\n  };\n\n  if (loadingServicos || loadingRegistro) {\n    return <div>Carregando...</div>;\n  }\n\n  if (!registro) {\n    return <div>Registro não encontrado</div>;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Editar PRT</h1>\n        <p className=\"text-muted-foreground\">Registro de Produtividade de Fiscalização - #{registro.numero_registro}</p>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Informações Gerais</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"competencia\">Competência</Label>\n                <Input\n                  id=\"competencia\"\n                  value={competencia}\n                  onChange={(e) => setCompetencia(e.target.value)}\n                  placeholder=\"MM/AAAA\"\n                  required\n                />\n              </div>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"anotacoes\">Anotações</Label>\n              <Textarea\n                id=\"anotacoes\"\n                value={anotacoes}\n                onChange={(e) => setAnotacoes(e.target.value)}\n                placeholder=\"Observações gerais sobre este registro...\"\n                rows={3}\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Adicionar Novo Serviço</CardTitle>\n            <CardDescription>Complete os campos abaixo para adicionar um item de serviço</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-12 gap-4\">\n              <div className=\"md:col-span-5\">\n                <Label>Tipo de Serviço *</Label>\n                <Select value={novoItem.servico_id} onValueChange={handleServicoChange}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Selecione o serviço\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-popover\">\n                    {servicos?.filter(servico => servico.id && servico.id.trim() !== '').map((servico) => (\n                      <SelectItem key={servico.id} value={servico.id}>\n                        {servico.descricao}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"md:col-span-3\">\n                <Label htmlFor=\"id_documento\">ID Documento *</Label>\n                <Input\n                  id=\"id_documento\"\n                  value={novoItem.id_documento}\n                  onChange={(e) => setNovoItem(prev => ({ ...prev, id_documento: e.target.value }))}\n                  placeholder=\"ID do documento\"\n                />\n              </div>\n\n              <div className=\"md:col-span-2\">\n                <Label htmlFor=\"qtd_fiscais\">Qtd. Fiscais *</Label>\n                <Input\n                  id=\"qtd_fiscais\"\n                  type=\"number\"\n                  min=\"1\"\n                  value={novoItem.qtd_fiscais}\n                  onChange={(e) => handleQtdFiscaisChange(Number(e.target.value))}\n                />\n              </div>\n\n              <div className=\"md:col-span-2\">\n                <Label htmlFor=\"quantidade\">Quantidade</Label>\n                <Input\n                  id=\"quantidade\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  value={novoItem.quantidade || ''}\n                  onChange={(e) => setNovoItem(prev => ({ \n                    ...prev, \n                    quantidade: e.target.value ? Number(e.target.value) : undefined \n                  }))}\n                  placeholder=\"Opcional\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"observacoes\">Observações</Label>\n                <Input\n                  id=\"observacoes\"\n                  value={novoItem.observacoes || ''}\n                  onChange={(e) => setNovoItem(prev => ({ ...prev, observacoes: e.target.value }))}\n                  placeholder=\"Observações sobre este item\"\n                />\n              </div>\n\n              <div>\n                <Label>Pontuação Calculada</Label>\n                <Input\n                  value={novoItem.pontuacao_calculada.toFixed(2)}\n                  readOnly\n                  className=\"bg-muted\"\n                />\n              </div>\n            </div>\n\n            <Button type=\"button\" onClick={adicionarItem} className=\"w-full\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Adicionar Item\n            </Button>\n          </CardContent>\n        </Card>\n\n        {itens.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Itens do Registro</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Serviço</TableHead>\n                    <TableHead>ID Documento</TableHead>\n                    <TableHead>Qtd. Fiscais</TableHead>\n                    <TableHead>Quantidade</TableHead>\n                    <TableHead>Pontuação</TableHead>\n                    <TableHead>Ações</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {itens.map((item) => {\n                    const servico = servicos?.find(s => s.id === item.servico_id);\n                    return (\n                      <TableRow key={item.tempId}>\n                        <TableCell>{servico?.descricao}</TableCell>\n                        <TableCell>{item.id_documento}</TableCell>\n                        <TableCell>{item.qtd_fiscais}</TableCell>\n                        <TableCell>{item.quantidade || '-'}</TableCell>\n                        <TableCell>{item.pontuacao_calculada.toFixed(2)}</TableCell>\n                        <TableCell>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => removerItem(item.tempId)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n\n              <div className=\"mt-4 p-4 bg-muted rounded-lg\">\n                <div className=\"flex justify-between items-center text-lg font-semibold\">\n                  <span>Total de Pontos:</span>\n                  <span>{totalPontos.toFixed(2)}</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex gap-4 justify-end\">\n          <Button type=\"button\" variant=\"outline\" onClick={() => navigate('/lista')}>\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={updateRegistro.isPending}>\n            {updateRegistro.isPending ? 'Salvando...' : 'Salvar Alterações'}\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}"
        }
    ]
}